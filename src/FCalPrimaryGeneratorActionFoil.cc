/*
This is the source code of Primary Generator Action class
Author: Zhaoyuan Cui

*/

#include "FCalPrimaryGeneratorActionFoil.hh"
#include "FCalGlobals.hh"

#include "G4Event.hh"
#include "G4ParticleGun.hh"
#include "G4ParticleTable.hh"
#include "G4ParticleDefinition.hh"
#include "globals.hh"
#include "G4ThreeVector.hh"
#include "Randomize.hh"


//// Constructor
FCalPrimaryGeneratorActionFoil::FCalPrimaryGeneratorActionFoil()
    : G4VUserPrimaryGeneratorAction(), fParticleGun(0)
{
    G4int nofParticles = 1;
    fParticleGun = new G4ParticleGun(nofParticles);

    // Find particle from particle table.
    G4String particleName;

    G4ParticleTable* particleTable = G4ParticleTable::GetParticleTable();
    G4ParticleDefinition* particle \
        = particleTable->FindParticle(particleName = "e-");

    // Initialize particle parameters.
    fParticleGun->SetParticleDefinition(particle);
}


//// Destructor
FCalPrimaryGeneratorActionFoil::~FCalPrimaryGeneratorActionFoil()
{
  delete fParticleGun;
}


void FCalPrimaryGeneratorActionFoil::GeneratePrimaries(G4Event* anEvent)
{
    double betaEng_SrY90[1000] = { 0.293304,0.936711,1.58034,2.22375,2.86807,3.51215,4.15647,4.80101,5.44601,6.091,6.736,7.38145,8.02713,8.67281,9.31871,9.96507,10.6114,11.2578,11.9048,12.5519,13.1991,13.8466,14.4944,15.1421,15.7898,16.438,17.0864,17.7346,18.3832,19.0318,19.6807,20.3293,20.9786,21.6277,22.2768,22.9261,23.5757,24.2252,24.8747,25.5247,26.1747,26.825,27.475,28.1252,28.7756,29.4258,30.0763,30.727,31.3774,32.0281,32.6788,33.3295,33.9801,34.631,35.2819,35.9328,36.5837,37.2346,37.8858,38.5367,39.1878,39.8389,40.4901,41.1412,41.7926,42.4437,43.0951,43.7464,44.3978,45.0489,45.7003,46.3516,47.003,47.6543,48.3057,48.957,49.6084,50.2598,50.9111,51.5625,52.2138,52.8652,53.5166,54.1679,54.8193,55.4706,56.122,56.7733,57.4247,58.0761,58.7274,59.3786,60.0299,60.6813,61.3324,61.9838,62.6349,63.2862,63.9374,64.5885,65.2396,65.8908,66.5419,67.193,67.8439,68.4951,69.1462,69.7973,70.4482,71.0994,71.7503,72.4014,73.0523,73.7032,74.3541,75.005,75.6559,76.3068,76.9577,77.6084,78.2593,78.91,79.5607,80.2113,80.862,81.5129,82.1636,82.8143,83.4649,84.1156,84.7663,85.4167,86.0674,86.7181,87.3685,88.0192,88.6697,89.3203,89.9708,90.6212,91.2717,91.9221,92.5726,93.223,93.8735,94.5239,95.1744,95.8248,96.4753,97.1257,97.7762,98.4264,99.0769,99.7273,100.378,101.028,101.679,102.329,102.979,103.63,104.28,104.93,105.581,106.231,106.882,107.532,108.182,108.833,109.483,110.134,110.784,111.434,112.085,112.736,113.386,114.037,114.687,115.338,115.989,116.639,117.29,117.94,118.591,119.242,119.893,120.543,121.194,121.845,122.496,123.146,123.797,124.448,125.099,125.75,126.401,127.053,127.704,128.355,129.006,129.658,130.309,130.96,131.612,132.263,132.915,133.567,134.218,134.87,135.522,136.173,136.825,137.477,138.129,138.781,139.434,140.086,140.738,141.391,142.043,142.696,143.349,144.001,144.654,145.307,145.96,146.613,147.266,147.919,148.573,149.226,149.88,150.533,151.187,151.841,152.495,153.149,153.803,154.458,155.112,155.767,156.421,157.076,157.731,158.386,159.041,159.697,160.352,161.007,161.663,162.319,162.975,163.631,164.287,164.943,165.6,166.256,166.914,167.571,168.228,168.885,169.543,170.201,170.858,171.517,172.175,172.833,173.492,174.15,174.809,175.468,176.128,176.787,177.447,178.107,178.767,179.426,180.087,180.748,181.408,182.069,182.731,183.393,184.054,184.716,185.379,186.041,186.704,187.367,188.03,188.693,189.357,190.021,190.685,191.35,192.015,192.679,193.344,194.01,194.676,195.341,196.008,196.675,197.342,198.009,198.677,199.345,200.013,200.681,201.35,202.019,202.689,203.359,204.028,204.699,205.37,206.04,206.711,207.383,208.055,208.727,209.4,210.074,210.747,211.421,212.096,212.771,213.446,214.121,214.797,215.473,216.15,216.827,217.505,218.182,218.861,219.539,220.218,220.898,221.578,222.258,222.939,223.621,224.302,224.984,225.668,226.351,227.035,227.719,228.404,229.089,229.775,230.461,231.148,231.835,232.523,233.211,233.899,234.589,235.279,235.969,236.66,237.352,238.044,238.737,239.431,240.125,240.819,241.515,242.211,242.907,243.604,244.302,244.999,245.698,246.398,247.098,247.798,248.5,249.202,249.904,250.608,251.312,252.016,252.722,253.429,254.136,254.844,255.553,256.263,256.972,257.684,258.395,259.107,259.821,260.535,261.249,261.965,262.682,263.398,264.117,264.836,265.555,266.276,266.998,267.72,268.444,269.169,269.894,270.62,271.348,272.076,272.805,273.536,274.266,274.998,275.731,276.465,277.199,277.936,278.673,279.409,280.15,280.891,281.632,282.376,283.12,283.864,284.611,285.358,286.106,286.856,287.607,288.358,289.112,289.866,290.621,291.378,292.136,292.894,293.656,294.419,295.182,295.948,296.715,297.481,298.252,299.022,299.793,300.568,301.343,302.117,302.896,303.675,304.455,305.238,306.022,306.806,307.595,308.384,309.174,309.968,310.762,311.557,312.356,313.154,313.956,314.759,315.562,316.369,317.178,317.986,318.799,319.612,320.427,321.247,322.067,322.889,323.715,324.541,325.37,326.201,327.032,327.869,328.706,329.544,330.387,331.23,332.076,332.925,333.774,334.628,335.484,336.34,337.204,338.067,338.934,339.804,340.675,341.551,342.428,343.308,344.192,345.076,345.965,346.857,347.75,348.649,349.548,350.453,351.362,352.271,353.188,354.105,355.027,355.952,356.878,357.811,358.745,359.685,360.627,361.572,362.522,363.473,364.435,365.398,366.366,367.338,368.312,369.294,370.275,371.267,372.258,373.257,374.259,375.265,376.278,377.292,378.319,379.345,380.382,381.42,382.467,383.517,384.573,385.635,386.702,387.776,388.854,389.941,391.032,392.135,393.241,394.358,395.477,396.608,397.741,398.887,400.035,401.195,402.358,403.534,404.714,405.906,407.105,408.318,409.539,410.768,412.009,413.255,414.517,415.783,417.066,418.355,419.657,420.973,422.301,423.645,424.996,426.365,427.745,429.136,430.547,431.966,433.403,434.86,436.33,437.823,439.33,440.851,442.396,443.958,445.536,447.137,448.765,450.414,452.082,453.782,455.502,457.246,459.013,460.812,462.647,464.511,466.405,468.33,470.287,472.283,474.315,476.385,478.499,480.659,482.862,485.109,487.403,489.745,492.145,494.602,497.113,499.68,502.307,504.999,507.761,510.581,513.461,516.41,519.422,522.493,525.625,528.802,532.024,535.287,538.575,541.878,545.184,548.488,551.788,555.084,558.378,561.668,564.954,568.238,571.519,574.796,578.071,581.342,584.611,587.877,591.141,594.401,597.659,600.914,604.167,607.418,610.666,613.911,617.154,620.396,623.634,626.871,630.105,633.338,636.568,639.797,643.024,646.248,649.471,652.692,655.911,659.129,662.345,665.559,668.772,671.983,675.193,678.401,681.608,684.813,688.018,691.221,694.422,697.623,700.822,704.02,707.217,710.413,713.608,716.802,719.995,723.187,726.379,729.569,732.759,735.948,739.136,742.324,745.51,748.697,751.882,755.067,758.252,761.436,764.619,767.803,770.985,774.168,777.35,780.532,783.714,786.895,790.076,793.257,796.438,799.619,802.799,805.98,809.161,812.341,815.522,818.703,821.884,825.065,828.247,831.428,834.61,837.792,840.974,844.157,847.34,850.524,853.708,856.892,860.077,863.262,866.448,869.635,872.822,876.01,879.198,882.387,885.577,888.768,891.959,895.151,898.344,901.538,904.733,907.929,911.126,914.324,917.523,920.723,923.923,927.126,930.329,933.533,936.739,939.946,943.155,946.364,949.575,952.787,956.001,959.216,962.433,965.651,968.871,972.092,975.315,978.54,981.766,984.994,988.224,991.455,994.689,997.924,1001.16,1004.4,1007.64,1010.88,1014.13,1017.38,1020.62,1023.88,1027.13,1030.39,1033.64,1036.9,1040.17,1043.43,1046.7,1049.97,1053.24,1056.51,1059.79,1063.07,1066.36,1069.64,1072.93,1076.22,1079.51,1082.81,1086.11,1089.41,1092.72,1096.03,1099.34,1102.65,1105.97,1109.29,1112.61,1115.94,1119.27,1122.61,1125.95,1129.29,1132.63,1135.98,1139.33,1142.69,1146.05,1149.42,1152.78,1156.16,1159.53,1162.91,1166.3,1169.68,1173.08,1176.47,1179.88,1183.28,1186.69,1190.11,1193.53,1196.95,1200.38,1203.81,1207.25,1210.7,1214.15,1217.6,1221.06,1224.53,1228,1231.47,1234.96,1238.44,1241.94,1245.43,1248.94,1252.45,1255.97,1259.49,1263.02,1266.56,1270.1,1273.65,1277.2,1280.76,1284.33,1287.91,1291.49,1295.08,1298.68,1302.29,1305.9,1309.52,1313.15,1316.78,1320.43,1324.08,1327.74,1331.41,1335.09,1338.77,1342.47,1346.17,1349.89,1353.61,1357.34,1361.08,1364.84,1368.6,1372.37,1376.15,1379.95,1383.75,1387.56,1391.39,1395.22,1399.07,1402.93,1406.8,1410.69,1414.58,1418.49,1422.41,1426.35,1430.3,1434.26,1438.23,1442.22,1446.22,1450.24,1454.27,1458.32,1462.38,1466.46,1470.56,1474.67,1478.8,1482.94,1487.11,1491.29,1495.48,1499.7,1503.94,1508.19,1512.47,1516.77,1521.08,1525.42,1529.78,1534.16,1538.57,1543,1547.45,1551.93,1556.43,1560.96,1565.51,1570.09,1574.7,1579.34,1584.01,1588.71,1593.44,1598.2,1602.99,1607.82,1612.68,1617.57,1622.51,1627.48,1632.49,1637.54,1642.63,1647.77,1652.95,1658.18,1663.45,1668.77,1674.15,1679.57,1685.06,1690.59,1696.19,1701.85,1707.57,1713.36,1719.22,1725.15,1731.16,1737.25,1743.42,1749.67,1756.02,1762.47,1769.01,1775.66,1782.43,1789.31,1796.32,1803.47,1810.75,1818.19,1825.8,1833.58,1841.55,1849.72,1858.11,1866.74,1875.64,1884.83,1894.33,1904.19,1914.46,1925.17,1936.4,1948.22,1960.73,1974.08,1988.43,2004.04,2021.27,2040.7,2063.33,2091.21,2129.91,2246.93 };

    double phi, x, y, z, r, Ekin;

    G4int num_betas = 500000;
    for (G4int i = 0; i < num_betas; i++) {
        // random beta energy
        Ekin = betaEng_SrY90[(int)(1000 * G4UniformRand())] * CLHEP::keV;

        // calculate random position on outside of foil
        z = FCal::foilZ * (2 * G4UniformRand() - 1);
        r = FCal::foilOuterRadius;
        phi = M_PI * (2 * G4UniformRand() - 1);
        x = r * cos(phi);
        y = r * sin(phi);

        // calculate random direction (z-Axis is parallel to tube axis)
        phi = M_PI * (2 * G4UniformRand() - 1);
        double cosTh = 2 * G4UniformRand() - 1;
        double sinTh = sqrt(1 - cosTh * cosTh);

        fParticleGun->SetParticlePosition(G4ThreeVector(x, y, z));
        fParticleGun->SetParticleEnergy(Ekin);
        fParticleGun->SetParticleMomentumDirection(G4ThreeVector(sinTh * cos(phi), sinTh * sin(phi), cosTh));

        fParticleGun->GeneratePrimaryVertex(anEvent);
    }
}
